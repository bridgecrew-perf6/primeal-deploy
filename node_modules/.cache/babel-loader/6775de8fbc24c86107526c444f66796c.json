{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ryany\\\\OneDrive\\\\\\u684C\\u9762\\\\primeal\\\\src\\\\pages\\\\customize\\\\components\\\\MtlRBtn.js\";\nimport { ReactComponent as Del } from '../../../imgs/del.svg';\nimport { ReactComponent as Plus } from '../../../imgs/plus.svg';\nimport { ReactComponent as Minus } from '../../../imgs/minus.svg';\nimport config from '../../../Config';\nimport { Draggable } from 'react-beautiful-dnd';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { createElement as _createElement } from \"react\";\n\nfunction MtlRBtn(props) {\n  const {\n    mtl_id,\n    mtl_name,\n    mtl_img_path,\n    removeMtl,\n    setRemoveMtl,\n    i,\n    el,\n    altTotal,\n    setAltTotal,\n    indexTotal,\n    setIndexTotal,\n    sushiGroup,\n    setSushiGroup\n  } = props; // console.log(props);\n  // console.log(removeMtl);\n\n  const getClassName = isDragging => ({\n    cursor: isDragging ? 'all-scroll' : 'pointer'\n  });\n\n  const changeHeightHandler = action => {\n    let returnGroup = [...sushiGroup]; // const clickItem = isChange[isChange.length - 1];\n\n    const addHeightObj = returnGroup[removeMtl.length - i - 1];\n\n    if (action === 'ADD') {\n      addHeightObj.height = addHeightObj.height + 0.125; // 預設增加高度\n\n      addHeightObj.alt = addHeightObj.alt + 0.125 / 2; // 預設增加y軸高度\n    }\n\n    if (action === 'MINUS') {\n      addHeightObj.height = addHeightObj.height - 0.125; // 預設增加高度\n\n      addHeightObj.alt = addHeightObj.alt - 0.125 / 2; // 預設增加y軸高度\n    }\n\n    const willAddAltArr = [...returnGroup].slice(removeMtl.length - i);\n    let AddedAltArr;\n\n    if (action === 'ADD') {\n      AddedAltArr = willAddAltArr.map(obj => {\n        return { ...obj,\n          alt: obj.alt + 0.125\n        }; // 預設增加高度\n      });\n    }\n\n    if (action === 'MINUS') {\n      AddedAltArr = willAddAltArr.map(obj => {\n        return { ...obj,\n          alt: obj.alt - 0.125\n        }; // 預設增加高度\n      });\n    }\n\n    const finalArr = [...returnGroup.slice(0, removeMtl.length - i - 1), addHeightObj, ...AddedAltArr];\n\n    if (action === 'ADD') {\n      setAltTotal(altTotal + 1);\n    }\n\n    if (action === 'MINUS') {\n      setAltTotal(altTotal - 1);\n    }\n\n    setSushiGroup(finalArr);\n  };\n\n  const deleteHandler = index => {\n    let returnGroup = [...sushiGroup];\n    const deleteBox = returnGroup[index];\n    const boxGroupArr = [...returnGroup].slice(index + 1);\n    const finalGroupBox = boxGroupArr.map(box => {\n      return { ...box,\n        alt: box.alt - deleteBox.height\n      };\n    });\n    const finalArr = [...returnGroup.slice(0, index), ...finalGroupBox];\n    setIndexTotal(indexTotal - 1);\n    const deleteAltAmount = deleteBox.height / 0.125 - 1;\n    setAltTotal(altTotal - deleteAltAmount);\n    setSushiGroup(finalArr);\n  }; // 刪除品項\n\n\n  const del = () => {\n    let originalMtlArr = [...removeMtl];\n    deleteHandler(originalMtlArr.length - i - 1);\n    originalMtlArr.splice(i, 1);\n    setRemoveMtl(originalMtlArr);\n  }; // 判斷總層數不可大於10\n\n\n  const countTotal = arr => {\n    const totalPct = arr.map(pct => pct.mtlPct);\n    return totalPct.reduce((x, y) => x + y);\n  }; // 輸入數量\n\n\n  const countIt = count => {\n    if (count <= 0 || count >= 6 || countTotal(removeMtl) > 10) {\n      return false;\n    }\n\n    const newList = JSON.parse(JSON.stringify(removeMtl)); // count:數量 / e:第幾個\n\n    const newCount = newList.map((v, index) => {\n      if (index === i) {\n        return {\n          mtlId: mtl_id,\n          mtlPct: count\n        };\n      } else {\n        return { ...v\n        };\n      }\n    });\n    setRemoveMtl(newCount);\n  }; // 數量-1\n\n\n  const contMinus = () => {\n    const newList = JSON.parse(JSON.stringify(removeMtl));\n    const newCount = newList.map((v, index) => {\n      if (index === i) {\n        if (el.mtlPct <= 1 || countTotal(removeMtl) > 10) {\n          return { ...v\n          };\n        }\n\n        changeHeightHandler('MINUS');\n        return {\n          mtlId: mtl_id,\n          mtlPct: el.mtlPct - 1\n        };\n      } else {\n        return { ...v\n        };\n      }\n    });\n    setRemoveMtl(newCount);\n  }; // 數量+1\n\n\n  const countAdd = () => {\n    const newList = JSON.parse(JSON.stringify(removeMtl));\n    const newCount = newList.map((v, index) => {\n      if (index === i) {\n        if (el.mtlPct >= 5 || countTotal(removeMtl) > 9) {\n          return { ...v\n          };\n        }\n\n        changeHeightHandler('ADD');\n        return {\n          mtlId: mtl_id,\n          mtlPct: el.mtlPct + 1\n        };\n      } else {\n        return { ...v\n        };\n      }\n    });\n    setRemoveMtl(newCount);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Draggable, {\n    draggableId: mtl_id + '123',\n    index: i,\n    children: (provided, snapshot) => {\n      return /*#__PURE__*/_createElement(\"div\", {\n        style: {\n          backgroundColor: '#c4c4c4'\n        },\n        ref: provided.innerRef,\n        ...provided.draggableProps,\n        ...provided.dragHandleProps,\n        className: `mtlRBtn my-3 mx-2 draggable ${snapshot.isDragging ? 'dragItem' : ''}`,\n        key: mtl_id,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mtlimg-r\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: `${config.HOST}${mtl_img_path}`,\n          alt: mtl_name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mtlname-r ch-cont-16 col px-4\",\n        children: mtl_name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"select-add-cart ch-cont-12\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"select-count\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => contMinus(i),\n            children: /*#__PURE__*/_jsxDEV(Minus, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"number\",\n            value: el.mtlPct,\n            onChange: e => countIt(+e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => countAdd(i),\n            children: /*#__PURE__*/_jsxDEV(Plus, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Del, {\n        className: \"mtlDelIcon\",\n        onClick: del\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 13\n      }, this));\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 165,\n    columnNumber: 5\n  }, this);\n}\n\n_c = MtlRBtn;\nexport default MtlRBtn;\n\nvar _c;\n\n$RefreshReg$(_c, \"MtlRBtn\");","map":{"version":3,"sources":["C:/Users/ryany/OneDrive/桌面/primeal/src/pages/customize/components/MtlRBtn.js"],"names":["ReactComponent","Del","Plus","Minus","config","Draggable","MtlRBtn","props","mtl_id","mtl_name","mtl_img_path","removeMtl","setRemoveMtl","i","el","altTotal","setAltTotal","indexTotal","setIndexTotal","sushiGroup","setSushiGroup","getClassName","isDragging","cursor","changeHeightHandler","action","returnGroup","addHeightObj","length","height","alt","willAddAltArr","slice","AddedAltArr","map","obj","finalArr","deleteHandler","index","deleteBox","boxGroupArr","finalGroupBox","box","deleteAltAmount","del","originalMtlArr","splice","countTotal","arr","totalPct","pct","mtlPct","reduce","x","y","countIt","count","newList","JSON","parse","stringify","newCount","v","mtlId","contMinus","countAdd","provided","snapshot","backgroundColor","innerRef","draggableProps","dragHandleProps","HOST","e","target","value"],"mappings":"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","sourcesContent":["import { ReactComponent as Del } from '../../../imgs/del.svg';\r\nimport { ReactComponent as Plus } from '../../../imgs/plus.svg';\r\nimport { ReactComponent as Minus } from '../../../imgs/minus.svg';\r\nimport config from '../../../Config';\r\nimport { Draggable } from 'react-beautiful-dnd';\r\n\r\nfunction MtlRBtn(props) {\r\n  const {\r\n    mtl_id,\r\n    mtl_name,\r\n    mtl_img_path,\r\n    removeMtl,\r\n    setRemoveMtl,\r\n    i,\r\n    el,\r\n    altTotal,\r\n    setAltTotal,\r\n    indexTotal,\r\n    setIndexTotal,\r\n    sushiGroup,\r\n    setSushiGroup,\r\n  } = props;\r\n  // console.log(props);\r\n  // console.log(removeMtl);\r\n\r\n  const getClassName = isDragging => ({\r\n    cursor: isDragging ? 'all-scroll' : 'pointer',\r\n  });\r\n\r\n  const changeHeightHandler = action => {\r\n    let returnGroup = [...sushiGroup];\r\n    // const clickItem = isChange[isChange.length - 1];\r\n    const addHeightObj = returnGroup[removeMtl.length - i - 1];\r\n\r\n    if (action === 'ADD') {\r\n      addHeightObj.height = addHeightObj.height + 0.125; // 預設增加高度\r\n      addHeightObj.alt = addHeightObj.alt + 0.125 / 2; // 預設增加y軸高度\r\n    }\r\n\r\n    if (action === 'MINUS') {\r\n      addHeightObj.height = addHeightObj.height - 0.125; // 預設增加高度\r\n      addHeightObj.alt = addHeightObj.alt - 0.125 / 2; // 預設增加y軸高度\r\n    }\r\n\r\n    const willAddAltArr = [...returnGroup].slice(removeMtl.length - i);\r\n    let AddedAltArr;\r\n\r\n    if (action === 'ADD') {\r\n      AddedAltArr = willAddAltArr.map(obj => {\r\n        return { ...obj, alt: obj.alt + 0.125 }; // 預設增加高度\r\n      });\r\n    }\r\n    if (action === 'MINUS') {\r\n      AddedAltArr = willAddAltArr.map(obj => {\r\n        return { ...obj, alt: obj.alt - 0.125 }; // 預設增加高度\r\n      });\r\n    }\r\n\r\n    const finalArr = [\r\n      ...returnGroup.slice(0, removeMtl.length - i - 1),\r\n      addHeightObj,\r\n      ...AddedAltArr,\r\n    ];\r\n\r\n    if (action === 'ADD') {\r\n      setAltTotal(altTotal + 1);\r\n    }\r\n    if (action === 'MINUS') {\r\n      setAltTotal(altTotal - 1);\r\n    }\r\n\r\n    setSushiGroup(finalArr);\r\n  };\r\n\r\n  const deleteHandler = index => {\r\n    let returnGroup = [...sushiGroup];\r\n    const deleteBox = returnGroup[index];\r\n    const boxGroupArr = [...returnGroup].slice(index + 1);\r\n\r\n    const finalGroupBox = boxGroupArr.map(box => {\r\n      return { ...box, alt: box.alt - deleteBox.height };\r\n    });\r\n\r\n    const finalArr = [...returnGroup.slice(0, index), ...finalGroupBox];\r\n\r\n    setIndexTotal(indexTotal - 1);\r\n    const deleteAltAmount = deleteBox.height / 0.125 - 1;\r\n    setAltTotal(altTotal - deleteAltAmount);\r\n    setSushiGroup(finalArr);\r\n  };\r\n\r\n  // 刪除品項\r\n  const del = () => {\r\n    let originalMtlArr = [...removeMtl];\r\n    deleteHandler(originalMtlArr.length - i - 1);\r\n    originalMtlArr.splice(i, 1);\r\n    setRemoveMtl(originalMtlArr);\r\n  };\r\n\r\n  // 判斷總層數不可大於10\r\n  const countTotal = arr => {\r\n    const totalPct = arr.map(pct => pct.mtlPct);\r\n    return totalPct.reduce((x, y) => x + y);\r\n  };\r\n\r\n  // 輸入數量\r\n  const countIt = count => {\r\n    if (count <= 0 || count >= 6 || countTotal(removeMtl) > 10) {\r\n      return false;\r\n    }\r\n    const newList = JSON.parse(JSON.stringify(removeMtl));\r\n\r\n    // count:數量 / e:第幾個\r\n\r\n    const newCount = newList.map((v, index) => {\r\n      if (index === i) {\r\n        return { mtlId: mtl_id, mtlPct: count };\r\n      } else {\r\n        return { ...v };\r\n      }\r\n    });\r\n\r\n    setRemoveMtl(newCount);\r\n  };\r\n\r\n  // 數量-1\r\n  const contMinus = () => {\r\n    const newList = JSON.parse(JSON.stringify(removeMtl));\r\n\r\n    const newCount = newList.map((v, index) => {\r\n      if (index === i) {\r\n        if (el.mtlPct <= 1 || countTotal(removeMtl) > 10) {\r\n          return { ...v };\r\n        }\r\n        changeHeightHandler('MINUS');\r\n        return { mtlId: mtl_id, mtlPct: el.mtlPct - 1 };\r\n      } else {\r\n        return { ...v };\r\n      }\r\n    });\r\n\r\n    setRemoveMtl(newCount);\r\n  };\r\n\r\n  // 數量+1\r\n  const countAdd = () => {\r\n    const newList = JSON.parse(JSON.stringify(removeMtl));\r\n\r\n    const newCount = newList.map((v, index) => {\r\n      if (index === i) {\r\n        if (el.mtlPct >= 5 || countTotal(removeMtl) > 9) {\r\n          return { ...v };\r\n        }\r\n        changeHeightHandler('ADD');\r\n        return { mtlId: mtl_id, mtlPct: el.mtlPct + 1 };\r\n      } else {\r\n        return { ...v };\r\n      }\r\n    });\r\n\r\n    setRemoveMtl(newCount);\r\n  };\r\n\r\n  return (\r\n    <Draggable draggableId={mtl_id + '123'} index={i}>\r\n      {(provided, snapshot) => {\r\n        return (\r\n          <div\r\n            style={{ backgroundColor: '#c4c4c4' }}\r\n            ref={provided.innerRef}\r\n            {...provided.draggableProps}\r\n            {...provided.dragHandleProps}\r\n            className={`mtlRBtn my-3 mx-2 draggable ${\r\n              snapshot.isDragging ? 'dragItem' : ''\r\n            }`}\r\n            key={mtl_id}\r\n          >\r\n            <div className=\"mtlimg-r\">\r\n              <img src={`${config.HOST}${mtl_img_path}`} alt={mtl_name} />\r\n            </div>\r\n            <div className=\"mtlname-r ch-cont-16 col px-4\">{mtl_name}</div>\r\n            <div className=\"select-add-cart ch-cont-12\">\r\n              <div className=\"select-count\">\r\n                <button onClick={() => contMinus(i)}>\r\n                  <Minus />\r\n                </button>\r\n                <input\r\n                  type=\"number\"\r\n                  value={el.mtlPct}\r\n                  onChange={e => countIt(+e.target.value)}\r\n                />\r\n                <button onClick={() => countAdd(i)}>\r\n                  <Plus />\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <Del className=\"mtlDelIcon\" onClick={del} />\r\n          </div>\r\n        );\r\n      }}\r\n    </Draggable>\r\n  );\r\n}\r\n\r\nexport default MtlRBtn;\r\n"]},"metadata":{},"sourceType":"module"}