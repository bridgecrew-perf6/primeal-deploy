{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ryany\\\\OneDrive\\\\\\u684C\\u9762\\\\primeal\\\\src\\\\pages\\\\share\\\\components\\\\ItemDetailsComments.js\",\n    _s = $RefreshSig$();\n\nimport styles from '../Share.module.scss';\nimport { useState, useEffect } from 'react';\nimport { ReactComponent as DeleteSm } from '../../../imgs/del.svg';\nimport TextareaAutosize from '@mui/material/TextareaAutosize';\nimport config from '../../../Config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst timeDifference = (current, previous) => {\n  const msPerMinute = 60 * 1000;\n  const msPerHour = msPerMinute * 60;\n  const msPerDay = msPerHour * 24;\n  const msPerMonth = msPerDay * 30;\n  const msPerYear = msPerDay * 365;\n  const elapsed = current - previous;\n\n  if (elapsed < msPerMinute) {\n    return Math.round(elapsed / 1000) + ' seconds ago';\n  } else if (elapsed < msPerHour) {\n    return Math.round(elapsed / msPerMinute) + ' minutes ago';\n  } else if (elapsed < msPerDay) {\n    return Math.round(elapsed / msPerHour) + ' hours ago';\n  } else if (elapsed < msPerMonth) {\n    return Math.round(elapsed / msPerDay) + ' days ago';\n  } else if (elapsed < msPerYear) {\n    return Math.round(elapsed / msPerMonth) + ' months ago';\n  } else {\n    return Math.round(elapsed / msPerYear) + ' years ago';\n  }\n};\n\nconst timeConvertHandler = time => {\n  const commentTimeStamp = Date.parse(time);\n  const now = Date.now();\n  return timeDifference(now, commentTimeStamp);\n};\n\nfunction ItemDetailsComments(props) {\n  _s();\n\n  const {\n    setMsgdiv,\n    shareComments,\n    itemId,\n    action,\n    commentSid,\n    handleShow,\n    setIsSubmit\n  } = props;\n  const [itemComments, setItemComments] = useState([]);\n  const [commentInput, setCommentInput] = useState('');\n  const [blink, setBlink] = useState(0);\n  const memId = localStorage.getItem('mem_id');\n  const memPhoto = localStorage.getItem('mem_photo');\n  const memNickname = localStorage.getItem('mem_nickname');\n\n  const uploadComment = async () => {\n    const response = await fetch(config.UPLOAD_COMMENT, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        itemId,\n        commentId: memId,\n        comment: commentInput,\n        commentTime: Date(Date.now())\n      })\n    });\n    const itemsArr = await response.json();\n    return itemsArr;\n  };\n\n  const updateComment = async () => {\n    const response = await fetch(config.UPDATE_COMMENT, {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        sid: commentSid,\n        itemId,\n        commentId: memId,\n        comment: commentInput,\n        commentTime: Date(Date.now())\n      })\n    });\n    handleShow();\n    const itemsArr = await response.json();\n    return itemsArr;\n  };\n\n  useEffect(() => {\n    setItemComments(shareComments);\n    const commentObj = shareComments.find(comment => comment.sid === commentSid);\n    if (action === 'COMMENT' && commentObj) setCommentInput(commentObj.comment);\n  }, [shareComments]);\n  useEffect(() => {}, [shareComments]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `${styles['message-section-box']}  d-flex flex-column`,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `d-flex mb-3 border-bottom ${styles['comment-header']}`,\n      children: [/*#__PURE__*/_jsxDEV(DeleteSm, {\n        className: `${styles['del-button']}`,\n        onClick: () => {\n          if (action === 'COMMENT') handleShow();\n          if (action === 'VIEW') setMsgdiv(false);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"en-title-18 mr-4 \",\n        children: \"Comments\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"en-title-18\",\n        children: itemComments.length\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `${styles['comment-section']} mb-4`,\n      children: [itemComments.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ch-cont-16 my-3\",\n        style: {\n          color: '#c4c4c4'\n        },\n        children: \"\\u6210\\u70BA\\u7B2C\\u4E00\\u500B\\u7559\\u8A00\\u7684\\u4EBA\\u5427~\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 11\n      }, this) : '', itemComments.map((_ref, i) => {\n        let {\n          blinkId = '',\n          sid,\n          comment,\n          item_comment_time: commentTime,\n          mem_nickname: commentName,\n          mem_photo_img_path: commentImg\n        } = _ref;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${blink === blinkId ? styles['fade-out-bg'] : ''} d-flex mt-5 mb-3`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${styles['profile-img-sm']} mb-2 mr-3 `,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: config.MEM_PHOTO + `/${commentImg}`,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex flex-column \",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"en-cont-14 mb-3 font-weight-bold\",\n              children: commentName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"ch-cont-14\",\n              children: comment\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"en-cont-12\",\n              children: timeConvertHandler(commentTime)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 17\n          }, this)]\n        }, commentTime + i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 15\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `${styles['my-comment']} d-flex mr-3`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"d-flex flex-column flex-grow-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${styles['profile-img-sm']} mr-3 `,\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: config.MEM_PHOTO + `/${memPhoto}`,\n              alt: \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextareaAutosize, {\n            maxRows: 1,\n            className: `${styles['comment-textarea']} ch-cont-14 flex-grow-1`,\n            placeholder: \" \\u6211\\u7684\\u60F3\\u6CD5...\",\n            value: commentInput,\n            onChange: e => {\n              setCommentInput(e.target.value);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-end\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `${styles['save-button-sm-border']} ch-title-14 mr-3 mb-3 btn-sm btn-outline-primary`,\n            onClick: () => setCommentInput(''),\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            disabled: commentInput ? false : true,\n            style: commentInput ? {\n              opacity: '1'\n            } : {\n              opacity: '0.7'\n            },\n            className: `${styles['save-button-sm']} ch-title-14 mb-3 btn-sm btn-primary`,\n            onClick: () => {\n              if (action === 'COMMENT') {\n                setIsSubmit(true);\n                updateComment();\n                return;\n              }\n\n              setBlink(blink + 1);\n              setItemComments([{\n                blinkId: blink + 1,\n                comment: commentInput,\n                item_comment_time: Date(Date.now()),\n                mem_nickname: memNickname,\n                mem_photo_img_path: memPhoto\n              }, ...itemComments]);\n              setCommentInput('');\n              uploadComment();\n            },\n            children: action === 'COMMENT' ? '修改' : '發佈'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ItemDetailsComments, \"Kctw08AeWa7/TFxKBN6870/PMP4=\");\n\n_c = ItemDetailsComments;\nexport default ItemDetailsComments; // comment\n// :\n// \"最近正是鮪魚最好吃的時候\"\n// item_comment_time\n// :\n// \"2021-02-12 12:30:00\"\n// mem_nickname\n// :\n// \"彦歆\"\n// mem_photo_img_path\n// :\n// \"23.jpg\"\n// member_id\n// :\n// 24\n// share_item_id\n// :\n// 3\n// sid\n// :\n// 21\n// new entry\n// :\n\nvar _c;\n\n$RefreshReg$(_c, \"ItemDetailsComments\");","map":{"version":3,"sources":["C:/Users/ryany/OneDrive/桌面/primeal/src/pages/share/components/ItemDetailsComments.js"],"names":["styles","useState","useEffect","ReactComponent","DeleteSm","TextareaAutosize","config","timeDifference","current","previous","msPerMinute","msPerHour","msPerDay","msPerMonth","msPerYear","elapsed","Math","round","timeConvertHandler","time","commentTimeStamp","Date","parse","now","ItemDetailsComments","props","setMsgdiv","shareComments","itemId","action","commentSid","handleShow","setIsSubmit","itemComments","setItemComments","commentInput","setCommentInput","blink","setBlink","memId","localStorage","getItem","memPhoto","memNickname","uploadComment","response","fetch","UPLOAD_COMMENT","method","headers","body","JSON","stringify","commentId","comment","commentTime","itemsArr","json","updateComment","UPDATE_COMMENT","sid","commentObj","find","length","color","map","i","blinkId","item_comment_time","mem_nickname","commentName","mem_photo_img_path","commentImg","MEM_PHOTO","e","target","value","opacity"],"mappings":"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","sourcesContent":["import styles from '../Share.module.scss';\r\nimport { useState, useEffect } from 'react';\r\n\r\nimport { ReactComponent as DeleteSm } from '../../../imgs/del.svg';\r\nimport TextareaAutosize from '@mui/material/TextareaAutosize';\r\nimport config from '../../../Config';\r\n\r\nconst timeDifference = (current, previous) => {\r\n  const msPerMinute = 60 * 1000;\r\n  const msPerHour = msPerMinute * 60;\r\n  const msPerDay = msPerHour * 24;\r\n  const msPerMonth = msPerDay * 30;\r\n  const msPerYear = msPerDay * 365;\r\n\r\n  const elapsed = current - previous;\r\n\r\n  if (elapsed < msPerMinute) {\r\n    return Math.round(elapsed / 1000) + ' seconds ago';\r\n  } else if (elapsed < msPerHour) {\r\n    return Math.round(elapsed / msPerMinute) + ' minutes ago';\r\n  } else if (elapsed < msPerDay) {\r\n    return Math.round(elapsed / msPerHour) + ' hours ago';\r\n  } else if (elapsed < msPerMonth) {\r\n    return Math.round(elapsed / msPerDay) + ' days ago';\r\n  } else if (elapsed < msPerYear) {\r\n    return Math.round(elapsed / msPerMonth) + ' months ago';\r\n  } else {\r\n    return Math.round(elapsed / msPerYear) + ' years ago';\r\n  }\r\n};\r\n\r\nconst timeConvertHandler = time => {\r\n  const commentTimeStamp = Date.parse(time);\r\n  const now = Date.now();\r\n  return timeDifference(now, commentTimeStamp);\r\n};\r\n\r\nfunction ItemDetailsComments(props) {\r\n  const {\r\n    setMsgdiv,\r\n    shareComments,\r\n    itemId,\r\n    action,\r\n    commentSid,\r\n    handleShow,\r\n    setIsSubmit,\r\n  } = props;\r\n\r\n  const [itemComments, setItemComments] = useState([]);\r\n  const [commentInput, setCommentInput] = useState('');\r\n  const [blink, setBlink] = useState(0);\r\n\r\n  const memId = localStorage.getItem('mem_id');\r\n  const memPhoto = localStorage.getItem('mem_photo');\r\n  const memNickname = localStorage.getItem('mem_nickname');\r\n\r\n  const uploadComment = async () => {\r\n    const response = await fetch(config.UPLOAD_COMMENT, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        itemId,\r\n        commentId: memId,\r\n        comment: commentInput,\r\n        commentTime: Date(Date.now()),\r\n      }),\r\n    });\r\n    const itemsArr = await response.json();\r\n    return itemsArr;\r\n  };\r\n\r\n  const updateComment = async () => {\r\n    const response = await fetch(config.UPDATE_COMMENT, {\r\n      method: 'PATCH',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        sid: commentSid,\r\n        itemId,\r\n        commentId: memId,\r\n        comment: commentInput,\r\n        commentTime: Date(Date.now()),\r\n      }),\r\n    });\r\n    handleShow();\r\n    const itemsArr = await response.json();\r\n    return itemsArr;\r\n  };\r\n\r\n  useEffect(() => {\r\n    setItemComments(shareComments);\r\n    const commentObj = shareComments.find(\r\n      comment => comment.sid === commentSid\r\n    );\r\n\r\n    if (action === 'COMMENT' && commentObj) setCommentInput(commentObj.comment);\r\n  }, [shareComments]);\r\n\r\n  useEffect(() => {}, [shareComments]);\r\n\r\n  return (\r\n    <div className={`${styles['message-section-box']}  d-flex flex-column`}>\r\n      <div className={`d-flex mb-3 border-bottom ${styles['comment-header']}`}>\r\n        <DeleteSm\r\n          className={`${styles['del-button']}`}\r\n          onClick={() => {\r\n            if (action === 'COMMENT') handleShow();\r\n            if (action === 'VIEW') setMsgdiv(false);\r\n          }}\r\n        />\r\n        <h2 className=\"en-title-18 mr-4 \">Comments</h2>\r\n        <h3 className=\"en-title-18\">{itemComments.length}</h3>\r\n      </div>\r\n      <div className={`${styles['comment-section']} mb-4`}>\r\n        {itemComments.length === 0 ? (\r\n          <div className=\"ch-cont-16 my-3\" style={{ color: '#c4c4c4' }}>\r\n            成為第一個留言的人吧~\r\n          </div>\r\n        ) : (\r\n          ''\r\n        )}\r\n        {itemComments.map(\r\n          (\r\n            {\r\n              blinkId = '',\r\n              sid,\r\n              comment,\r\n              item_comment_time: commentTime,\r\n              mem_nickname: commentName,\r\n              mem_photo_img_path: commentImg,\r\n            },\r\n            i\r\n          ) => {\r\n            return (\r\n              <div\r\n                key={commentTime + i}\r\n                className={`${\r\n                  blink === blinkId ? styles['fade-out-bg'] : ''\r\n                } d-flex mt-5 mb-3`}\r\n              >\r\n                <div className={`${styles['profile-img-sm']} mb-2 mr-3 `}>\r\n                  <img src={config.MEM_PHOTO + `/${commentImg}`} alt=\"\" />\r\n                </div>\r\n                <div className=\"d-flex flex-column \">\r\n                  <h2 className=\"en-cont-14 mb-3 font-weight-bold\">\r\n                    {commentName}\r\n                  </h2>\r\n                  <p className=\"ch-cont-14\">{comment}</p>\r\n                  <p className=\"en-cont-12\">\r\n                    {timeConvertHandler(commentTime)}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            );\r\n          }\r\n        )}\r\n      </div>\r\n      <div className={`${styles['my-comment']} d-flex mr-3`}>\r\n        <div className=\"d-flex flex-column flex-grow-1\">\r\n          <div className=\"d-flex mb-3\">\r\n            <div className={`${styles['profile-img-sm']} mr-3 `}>\r\n              <img src={config.MEM_PHOTO + `/${memPhoto}`} alt=\"\" />\r\n            </div>\r\n            <TextareaAutosize\r\n              maxRows={1}\r\n              className={`${styles['comment-textarea']} ch-cont-14 flex-grow-1`}\r\n              placeholder=\" 我的想法...\"\r\n              value={commentInput}\r\n              onChange={e => {\r\n                setCommentInput(e.target.value);\r\n              }}\r\n            />\r\n          </div>\r\n          <div className=\"d-flex justify-content-end\">\r\n            <button\r\n              className={`${styles['save-button-sm-border']} ch-title-14 mr-3 mb-3 btn-sm btn-outline-primary`}\r\n              onClick={() => setCommentInput('')}\r\n            >\r\n              取消\r\n            </button>\r\n            <button\r\n              disabled={commentInput ? false : true}\r\n              style={commentInput ? { opacity: '1' } : { opacity: '0.7' }}\r\n              className={`${styles['save-button-sm']} ch-title-14 mb-3 btn-sm btn-primary`}\r\n              onClick={() => {\r\n                if (action === 'COMMENT') {\r\n                  setIsSubmit(true);\r\n                  updateComment();\r\n                  return;\r\n                }\r\n                setBlink(blink + 1);\r\n                setItemComments([\r\n                  {\r\n                    blinkId: blink + 1,\r\n                    comment: commentInput,\r\n                    item_comment_time: Date(Date.now()),\r\n                    mem_nickname: memNickname,\r\n                    mem_photo_img_path: memPhoto,\r\n                  },\r\n                  ...itemComments,\r\n                ]);\r\n                setCommentInput('');\r\n                uploadComment();\r\n              }}\r\n            >\r\n              {action === 'COMMENT' ? '修改' : '發佈'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ItemDetailsComments;\r\n\r\n// comment\r\n// :\r\n// \"最近正是鮪魚最好吃的時候\"\r\n// item_comment_time\r\n// :\r\n// \"2021-02-12 12:30:00\"\r\n// mem_nickname\r\n// :\r\n// \"彦歆\"\r\n// mem_photo_img_path\r\n// :\r\n// \"23.jpg\"\r\n// member_id\r\n// :\r\n// 24\r\n// share_item_id\r\n// :\r\n// 3\r\n// sid\r\n// :\r\n// 21\r\n// new entry\r\n// :\r\n"]},"metadata":{},"sourceType":"module"}