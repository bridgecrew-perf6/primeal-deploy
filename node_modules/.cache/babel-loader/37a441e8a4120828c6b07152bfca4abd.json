{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ryany\\\\OneDrive\\\\\\u684C\\u9762\\\\primeal\\\\src\\\\pages\\\\share\\\\ShareEdit.js\",\n    _s = $RefreshSig$();\n\nimport { Header, Title, AsideLeft, AsideRight, Footer } from '../layout/Layout';\nimport styles from './Share.module.scss';\nimport config from '../../Config';\nimport { getMemId } from '../../utils';\nimport { ReactComponent as Delete } from '../../imgs/delete-lg.svg';\nimport EditImgPreview from './components/EditImgPreview';\nimport EditForm from './components/EditForm';\nimport NavPage from '../layout/components/NavPage';\nimport { useState, useEffect } from 'react';\nimport { useLocation, useHistory, Link } from 'react-router-dom';\nimport { Button, Modal } from 'react-bootstrap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst initFormState = {\n  title: '',\n  content: '',\n  tags: []\n};\nconst initErrorState = {\n  title: '',\n  content: '',\n  files: ''\n};\n\nfunction ShareEdit(props) {\n  _s();\n\n  const [files, setFiles] = useState([]);\n  const [formState, setFormState] = useState(initFormState);\n  const [errorState, setErrorState] = useState(initErrorState);\n  const [formIsValid, setFormIsValid] = useState(true);\n  const [tagsInput, setTagsInput] = useState([]);\n  const [foundTags, setFoundTags] = useState([]); // 取得用戶id\n\n  const mem_id = getMemId(); // 加入購物車光箱\n\n  const [show, setShow] = useState(false); //加入NAVBar漢堡選單開關\n\n  const showBlock = {\n    display: 'block'\n  };\n  const hiddenBlock = {\n    display: 'none'\n  };\n  const {\n    navIsOpen,\n    setNavIsOpen\n  } = props; // 解構NAVBAR\n\n  const location = useLocation(null);\n  const history = useHistory(null);\n  const {\n    action = 'ADD',\n    shareId = '',\n    orderId,\n    orderName = '',\n    shareTitle = '',\n    shareDesc = '',\n    itemImgs,\n    shareTags = [],\n    orderCate = ''\n  } = location.state || {};\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const getFoundTags = async () => {\n    try {\n      const response = await fetch(config.GET_TAGS, {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json'\n        },\n        body: JSON.stringify(tagsInput[0])\n      });\n      if (!response.ok) throw new Error('No tags found!');\n      const itemsObj = await response.json();\n      return itemsObj;\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const checkFormValidity = e => {\n    e.preventDefault();\n\n    if (!formState.title || !formState.content || files.length === 0) {\n      setFormIsValid(false);\n      return;\n    }\n\n    if (action === 'UPDATE') {\n      submitUpdate();\n    }\n\n    if (action === 'ADD') {\n      submitUpload();\n    }\n  };\n\n  const submitUpload = async () => {\n    try {\n      if (!orderId) throw new Error('Unsuccessful upload !');\n      const submitForm = { ...formState\n      };\n      const fd = new FormData();\n      const formArr = Object.entries(submitForm);\n      formArr.map(arr => {\n        return fd.append(arr[0], arr[1]);\n      }); // insert order id and images into formdata\n\n      fd.append('orderId', orderId);\n      files.map(file => fd.append('files', file));\n      const response = await fetch(config.UPLOAD_POST, {\n        method: 'POST',\n        'Content-Type': 'multipart/form-data',\n        body: fd\n      });\n      if (!response.ok) throw new Error('Unsuccessful upload !');\n      handleShow();\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const submitUpdate = async () => {\n    try {\n      if (!orderId) throw new Error('Unsuccessful upload !');\n      let updateFiles = [...files];\n      updateFiles = updateFiles.map((file, i) => {\n        return { ...file,\n          share_img_order: i + 1\n        };\n      });\n      const updateForm = { ...formState,\n        images: updateFiles,\n        shareId\n      };\n      const response = await fetch(config.UPDATE_POST, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updateForm)\n      });\n      if (!response.ok) throw new Error('Unsuccessful update !');\n      handleShow();\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const creditAmountHandler = () => {\n    const cateCredits = [{\n      cate: 'cs',\n      credit: 300\n    }, {\n      cate: 'cm',\n      credit: 500\n    }, {\n      cate: 'set',\n      credit: 800\n    }];\n    const amount = cateCredits.find(cateObj => cateObj.cate === orderCate);\n    return amount.credit;\n  };\n\n  const addCreditHandler = async () => {\n    const res = await fetch(config.ADD_CREDIT + `${mem_id}/${creditAmountHandler()}`);\n    const result = res.json();\n\n    if (result.success) {// console.log('積分已加入資料庫');\n    }\n  };\n\n  const modal = /*#__PURE__*/_jsxDEV(Modal, {\n    show: show,\n    onHide: handleClose,\n    children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n      closeButton: true,\n      children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n        className: \"en-cont-30 m-3\",\n        children: \"\\u63D0\\u9192\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n      style: {\n        margin: '0 3%'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"en-cont-14 pb-2\",\n        children: action === 'UPDATE' ? '您的貼文已編輯成功!' : `您的貼文上傳成功! 恭喜您獲得會員積分${creditAmountHandler()}點!`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"secondary\",\n        className: \"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\",\n        onClick: () => {\n          if (action === 'ADD') {\n            // console.log('新增積分300點');\n            addCreditHandler();\n          }\n\n          history.push('/share');\n        },\n        children: \"Close\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 171,\n    columnNumber: 5\n  }, this); // Finding tags when tag input changed\n\n\n  useEffect(() => {\n    if (Object.keys(tagsInput).length === 0) return;\n\n    (async () => {\n      const result = await getFoundTags();\n\n      if (!result) {\n        setFoundTags([]);\n      } else {\n        setFoundTags(result.data);\n      }\n    })();\n  }, [tagsInput]);\n  useEffect(() => {\n    setFormState({\n      title: shareTitle,\n      content: shareDesc,\n      tags: shareTags.map(tag => tag.item_hash)\n    });\n    if (action === 'UPDATE') setFiles(itemImgs);\n  }, []); // const fileInputHandler = () => {\n  //   if (!fileInputRef.current) return '新增、拖曳照片';\n  //   let filesLength = fileInputRef.current.files.length;\n  //   if (filesLength !== 0) return `選擇${filesLength}個檔案`;\n  // };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [modal, /*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }, this), navIsOpen && /*#__PURE__*/_jsxDEV(NavPage, {\n      navIsOpen: navIsOpen,\n      setNavIsOpen: setNavIsOpen\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: navIsOpen ? hiddenBlock : showBlock,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex'\n        },\n        children: [/*#__PURE__*/_jsxDEV(AsideLeft, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Title, {\n            title: 'Share',\n            setNavIsOpen: setNavIsOpen\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `mycontainer  ${styles['share-bread']}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"row\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"col\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"d-flex justify-content-between\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"pt-3 pt-md-0\",\n                    children: /*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"en-title-14-10 d-flex\",\n                      children: [/*#__PURE__*/_jsxDEV(Link, {\n                        to: '/',\n                        style: {\n                          textDecoration: 'none',\n                          color: '#575757'\n                        },\n                        children: \"HOME/\\xA0\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 248,\n                        columnNumber: 25\n                      }, this), /*#__PURE__*/_jsxDEV(Link, {\n                        to: '/share',\n                        style: {\n                          textDecoration: 'none',\n                          color: '#575757'\n                        },\n                        children: \"SHARE/\\xA0\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 254,\n                        columnNumber: 25\n                      }, this), /*#__PURE__*/_jsxDEV(Link, {\n                        to: `/share/edit`,\n                        style: {\n                          textDecoration: 'none',\n                          color: '#b03342'\n                        },\n                        children: action === 'UPDATE' ? 'EDIT' : 'UPLOAD'\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 260,\n                        columnNumber: 25\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 247,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 246,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"d-flex align-items-center\",\n                    children: /*#__PURE__*/_jsxDEV(Delete, {\n                      className: `${styles['large-del']} mx-md-4 p-2`,\n                      onClick: () => history.goBack(-1)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 269,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 268,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 245,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `${styles['waterfall-container']} ${styles['edit-min-height']}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"container\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"row\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"col d-flex flex-column\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"col\",\n                    children: /*#__PURE__*/_jsxDEV(\"h2\", {\n                      className: `${styles['share-edit-header']} mb-5`,\n                      children: action === 'UPDATE' ? '編輯貼文' : '分享貼文'\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 286,\n                      columnNumber: 23\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 285,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"d-flex\",\n                    children: [/*#__PURE__*/_jsxDEV(EditImgPreview, {\n                      files: files,\n                      setFiles: setFiles,\n                      errorState: errorState,\n                      action: action\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 292,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `col-md-12 ${styles['form-min-height']}`,\n                      children: /*#__PURE__*/_jsxDEV(\"form\", {\n                        children: [/*#__PURE__*/_jsxDEV(EditForm, {\n                          formState: formState,\n                          setFormState: setFormState,\n                          setFiles: setFiles,\n                          tagsInput: tagsInput,\n                          foundTags: foundTags,\n                          setTagsInput: setTagsInput,\n                          orderName: orderName,\n                          errorState: errorState,\n                          setErrorState: setErrorState,\n                          files: files,\n                          formIsValid: formIsValid\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 301,\n                          columnNumber: 27\n                        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                          className: \"d-flex justify-content-end\",\n                          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                            type: \"reset\",\n                            className: `${styles['primeal-btn-outline-sm']} btn-sm btn-outline-primary mr-3`,\n                            onClick: () => {\n                              setFormState(initFormState);\n                              if (action !== 'UPDATE') setFiles([]);\n                            },\n                            children: \"\\u6E05\\u9664\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 315,\n                            columnNumber: 29\n                          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                            className: `${styles['primeal-btn-sm']} btn-sm btn-primary`,\n                            onClick: e => {\n                              checkFormValidity(e);\n                            },\n                            children: action === 'UPDATE' ? '編輯' : '分享'\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 325,\n                            columnNumber: 29\n                          }, this)]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 314,\n                          columnNumber: 27\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 300,\n                        columnNumber: 25\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 299,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 290,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 284,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 283,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 341,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(AsideRight, {\n          setNavIsOpen: setNavIsOpen\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(ShareEdit, \"oWyqrr94GsewfvCjbnnPiyt22K4=\", false, function () {\n  return [useLocation, useHistory];\n});\n\n_c = ShareEdit;\nexport default ShareEdit;\n\nvar _c;\n\n$RefreshReg$(_c, \"ShareEdit\");","map":{"version":3,"sources":["C:/Users/ryany/OneDrive/桌面/primeal/src/pages/share/ShareEdit.js"],"names":["Header","Title","AsideLeft","AsideRight","Footer","styles","config","getMemId","ReactComponent","Delete","EditImgPreview","EditForm","NavPage","useState","useEffect","useLocation","useHistory","Link","Button","Modal","initFormState","title","content","tags","initErrorState","files","ShareEdit","props","setFiles","formState","setFormState","errorState","setErrorState","formIsValid","setFormIsValid","tagsInput","setTagsInput","foundTags","setFoundTags","mem_id","show","setShow","showBlock","display","hiddenBlock","navIsOpen","setNavIsOpen","location","history","action","shareId","orderId","orderName","shareTitle","shareDesc","itemImgs","shareTags","orderCate","state","handleClose","handleShow","getFoundTags","response","fetch","GET_TAGS","method","headers","body","JSON","stringify","ok","Error","itemsObj","json","err","console","error","message","checkFormValidity","e","preventDefault","length","submitUpdate","submitUpload","submitForm","fd","FormData","formArr","Object","entries","map","arr","append","file","UPLOAD_POST","updateFiles","i","share_img_order","updateForm","images","UPDATE_POST","creditAmountHandler","cateCredits","cate","credit","amount","find","cateObj","addCreditHandler","res","ADD_CREDIT","result","success","modal","margin","push","keys","data","tag","item_hash","width","textDecoration","color","goBack"],"mappings":";;;AAAA,SAASA,MAAT,EAAiBC,KAAjB,EAAwBC,SAAxB,EAAmCC,UAAnC,EAA+CC,MAA/C,QAA6D,kBAA7D;AACA,OAAOC,MAAP,MAAmB,qBAAnB;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,SAASC,QAAT,QAAyB,aAAzB;AAEA,SAASC,cAAc,IAAIC,MAA3B,QAAyC,0BAAzC;AACA,OAAOC,cAAP,MAA2B,6BAA3B;AACA,OAAOC,QAAP,MAAqB,uBAArB;AACA,OAAOC,OAAP,MAAoB,8BAApB;AAEA,SAASC,QAAT,EAAmBC,SAAnB,QAAoC,OAApC;AACA,SAASC,WAAT,EAAsBC,UAAtB,EAAkCC,IAAlC,QAA8C,kBAA9C;AAEA,SAASC,MAAT,EAAiBC,KAAjB,QAA8B,iBAA9B;;;AAEA,MAAMC,aAAa,GAAG;AACpBC,EAAAA,KAAK,EAAE,EADa;AAEpBC,EAAAA,OAAO,EAAE,EAFW;AAGpBC,EAAAA,IAAI,EAAE;AAHc,CAAtB;AAMA,MAAMC,cAAc,GAAG;AACrBH,EAAAA,KAAK,EAAE,EADc;AAErBC,EAAAA,OAAO,EAAE,EAFY;AAGrBG,EAAAA,KAAK,EAAE;AAHc,CAAvB;;AAMA,SAASC,SAAT,CAAmBC,KAAnB,EAA0B;AAAA;;AACxB,QAAM,CAACF,KAAD,EAAQG,QAAR,IAAoBf,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM,CAACgB,SAAD,EAAYC,YAAZ,IAA4BjB,QAAQ,CAACO,aAAD,CAA1C;AACA,QAAM,CAACW,UAAD,EAAaC,aAAb,IAA8BnB,QAAQ,CAACW,cAAD,CAA5C;AACA,QAAM,CAACS,WAAD,EAAcC,cAAd,IAAgCrB,QAAQ,CAAC,IAAD,CAA9C;AACA,QAAM,CAACsB,SAAD,EAAYC,YAAZ,IAA4BvB,QAAQ,CAAC,EAAD,CAA1C;AACA,QAAM,CAACwB,SAAD,EAAYC,YAAZ,IAA4BzB,QAAQ,CAAC,EAAD,CAA1C,CANwB,CAQxB;;AACA,QAAM0B,MAAM,GAAGhC,QAAQ,EAAvB,CATwB,CAWxB;;AACA,QAAM,CAACiC,IAAD,EAAOC,OAAP,IAAkB5B,QAAQ,CAAC,KAAD,CAAhC,CAZwB,CAcxB;;AACA,QAAM6B,SAAS,GAAG;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAlB;AACA,QAAMC,WAAW,GAAG;AAAED,IAAAA,OAAO,EAAE;AAAX,GAApB;AACA,QAAM;AAAEE,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA8BnB,KAApC,CAjBwB,CAiBmB;;AAE3C,QAAMoB,QAAQ,GAAGhC,WAAW,CAAC,IAAD,CAA5B;AACA,QAAMiC,OAAO,GAAGhC,UAAU,CAAC,IAAD,CAA1B;AACA,QAAM;AACJiC,IAAAA,MAAM,GAAG,KADL;AAEJC,IAAAA,OAAO,GAAG,EAFN;AAGJC,IAAAA,OAHI;AAIJC,IAAAA,SAAS,GAAG,EAJR;AAKJC,IAAAA,UAAU,GAAG,EALT;AAMJC,IAAAA,SAAS,GAAG,EANR;AAOJC,IAAAA,QAPI;AAQJC,IAAAA,SAAS,GAAG,EARR;AASJC,IAAAA,SAAS,GAAG;AATR,MAUFV,QAAQ,CAACW,KAAT,IAAkB,EAVtB;;AAYA,QAAMC,WAAW,GAAG,MAAMlB,OAAO,CAAC,KAAD,CAAjC;;AACA,QAAMmB,UAAU,GAAG,MAAMnB,OAAO,CAAC,IAAD,CAAhC;;AAEA,QAAMoB,YAAY,GAAG,YAAY;AAC/B,QAAI;AACF,YAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACzD,MAAM,CAAC0D,QAAR,EAAkB;AAC5CC,QAAAA,MAAM,EAAE,MADoC;AAE5CC,QAAAA,OAAO,EAAE;AAAE,0BAAgB;AAAlB,SAFmC;AAG5CC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAelC,SAAS,CAAC,CAAD,CAAxB;AAHsC,OAAlB,CAA5B;AAKA,UAAI,CAAC2B,QAAQ,CAACQ,EAAd,EAAkB,MAAM,IAAIC,KAAJ,CAAU,gBAAV,CAAN;AAClB,YAAMC,QAAQ,GAAG,MAAMV,QAAQ,CAACW,IAAT,EAAvB;AACA,aAAOD,QAAP;AACD,KATD,CASE,OAAOE,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,KAAR,CAAcF,GAAG,CAACG,OAAlB;AACD;AACF,GAbD;;AAeA,QAAMC,iBAAiB,GAAGC,CAAC,IAAI;AAC7BA,IAAAA,CAAC,CAACC,cAAF;;AAEA,QAAI,CAACnD,SAAS,CAACR,KAAX,IAAoB,CAACQ,SAAS,CAACP,OAA/B,IAA0CG,KAAK,CAACwD,MAAN,KAAiB,CAA/D,EAAkE;AAChE/C,MAAAA,cAAc,CAAC,KAAD,CAAd;AACA;AACD;;AACD,QAAIe,MAAM,KAAK,QAAf,EAAyB;AACvBiC,MAAAA,YAAY;AACb;;AACD,QAAIjC,MAAM,KAAK,KAAf,EAAsB;AACpBkC,MAAAA,YAAY;AACb;AACF,GAbD;;AAeA,QAAMA,YAAY,GAAG,YAAY;AAC/B,QAAI;AACF,UAAI,CAAChC,OAAL,EAAc,MAAM,IAAIoB,KAAJ,CAAU,uBAAV,CAAN;AAEd,YAAMa,UAAU,GAAG,EAAE,GAAGvD;AAAL,OAAnB;AACA,YAAMwD,EAAE,GAAG,IAAIC,QAAJ,EAAX;AACA,YAAMC,OAAO,GAAGC,MAAM,CAACC,OAAP,CAAeL,UAAf,CAAhB;AACAG,MAAAA,OAAO,CAACG,GAAR,CAAYC,GAAG,IAAI;AACjB,eAAON,EAAE,CAACO,MAAH,CAAUD,GAAG,CAAC,CAAD,CAAb,EAAkBA,GAAG,CAAC,CAAD,CAArB,CAAP;AACD,OAFD,EANE,CAUF;;AACAN,MAAAA,EAAE,CAACO,MAAH,CAAU,SAAV,EAAqBzC,OAArB;AACA1B,MAAAA,KAAK,CAACiE,GAAN,CAAUG,IAAI,IAAIR,EAAE,CAACO,MAAH,CAAU,OAAV,EAAmBC,IAAnB,CAAlB;AAEA,YAAM/B,QAAQ,GAAG,MAAMC,KAAK,CAACzD,MAAM,CAACwF,WAAR,EAAqB;AAC/C7B,QAAAA,MAAM,EAAE,MADuC;AAE/C,wBAAgB,qBAF+B;AAG/CE,QAAAA,IAAI,EAAEkB;AAHyC,OAArB,CAA5B;AAKA,UAAI,CAACvB,QAAQ,CAACQ,EAAd,EAAkB,MAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AAClBX,MAAAA,UAAU;AACX,KArBD,CAqBE,OAAOc,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,KAAR,CAAcF,GAAG,CAACG,OAAlB;AACD;AACF,GAzBD;;AA2BA,QAAMK,YAAY,GAAG,YAAY;AAC/B,QAAI;AACF,UAAI,CAAC/B,OAAL,EAAc,MAAM,IAAIoB,KAAJ,CAAU,uBAAV,CAAN;AAEd,UAAIwB,WAAW,GAAG,CAAC,GAAGtE,KAAJ,CAAlB;AACAsE,MAAAA,WAAW,GAAGA,WAAW,CAACL,GAAZ,CAAgB,CAACG,IAAD,EAAOG,CAAP,KAAa;AACzC,eAAO,EAAE,GAAGH,IAAL;AAAWI,UAAAA,eAAe,EAAED,CAAC,GAAG;AAAhC,SAAP;AACD,OAFa,CAAd;AAIA,YAAME,UAAU,GAAG,EACjB,GAAGrE,SADc;AAEjBsE,QAAAA,MAAM,EAAEJ,WAFS;AAGjB7C,QAAAA;AAHiB,OAAnB;AAMA,YAAMY,QAAQ,GAAG,MAAMC,KAAK,CAACzD,MAAM,CAAC8F,WAAR,EAAqB;AAC/CnC,QAAAA,MAAM,EAAE,OADuC;AAE/CC,QAAAA,OAAO,EAAE;AAAE,0BAAgB;AAAlB,SAFsC;AAG/CC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe6B,UAAf;AAHyC,OAArB,CAA5B;AAKA,UAAI,CAACpC,QAAQ,CAACQ,EAAd,EAAkB,MAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AAClBX,MAAAA,UAAU;AACX,KArBD,CAqBE,OAAOc,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACC,KAAR,CAAcF,GAAG,CAACG,OAAlB;AACD;AACF,GAzBD;;AA2BA,QAAMwB,mBAAmB,GAAG,MAAM;AAChC,UAAMC,WAAW,GAAG,CAClB;AAAEC,MAAAA,IAAI,EAAE,IAAR;AAAcC,MAAAA,MAAM,EAAE;AAAtB,KADkB,EAElB;AAAED,MAAAA,IAAI,EAAE,IAAR;AAAcC,MAAAA,MAAM,EAAE;AAAtB,KAFkB,EAGlB;AAAED,MAAAA,IAAI,EAAE,KAAR;AAAeC,MAAAA,MAAM,EAAE;AAAvB,KAHkB,CAApB;AAMA,UAAMC,MAAM,GAAGH,WAAW,CAACI,IAAZ,CAAiBC,OAAO,IAAIA,OAAO,CAACJ,IAAR,KAAiB9C,SAA7C,CAAf;AAEA,WAAOgD,MAAM,CAACD,MAAd;AACD,GAVD;;AAYA,QAAMI,gBAAgB,GAAG,YAAY;AACnC,UAAMC,GAAG,GAAG,MAAM9C,KAAK,CACrBzD,MAAM,CAACwG,UAAP,GAAqB,GAAEvE,MAAO,IAAG8D,mBAAmB,EAAG,EADlC,CAAvB;AAGA,UAAMU,MAAM,GAAGF,GAAG,CAACpC,IAAJ,EAAf;;AACA,QAAIsC,MAAM,CAACC,OAAX,EAAoB,CAClB;AACD;AACF,GARD;;AAUA,QAAMC,KAAK,gBACT,QAAC,KAAD;AAAO,IAAA,IAAI,EAAEzE,IAAb;AAAmB,IAAA,MAAM,EAAEmB,WAA3B;AAAA,4BACE,QAAC,KAAD,CAAO,MAAP;AAAc,MAAA,WAAW,MAAzB;AAAA,6BACE,QAAC,KAAD,CAAO,KAAP;AAAa,QAAA,SAAS,EAAC,gBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YADF,eAIE,QAAC,KAAD,CAAO,IAAP;AAAY,MAAA,KAAK,EAAE;AAAEuD,QAAAA,MAAM,EAAE;AAAV,OAAnB;AAAA,6BACE;AAAK,QAAA,SAAS,EAAC,iBAAf;AAAA,kBACGjE,MAAM,KAAK,QAAX,GACG,YADH,GAEI,sBAAqBoD,mBAAmB,EAAG;AAHlD;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAJF,eAWE,QAAC,KAAD,CAAO,MAAP;AAAA,6BACE,QAAC,MAAD;AACE,QAAA,OAAO,EAAC,WADV;AAEE,QAAA,SAAS,EAAC,gDAFZ;AAGE,QAAA,OAAO,EAAE,MAAM;AACb,cAAIpD,MAAM,KAAK,KAAf,EAAsB;AACpB;AACA2D,YAAAA,gBAAgB;AACjB;;AACD5D,UAAAA,OAAO,CAACmE,IAAR,CAAa,QAAb;AACD,SATH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YAXF;AAAA;AAAA;AAAA;AAAA;AAAA,UADF,CA9IwB,CA4KxB;;;AACArG,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI0E,MAAM,CAAC4B,IAAP,CAAYjF,SAAZ,EAAuB8C,MAAvB,KAAkC,CAAtC,EAAyC;;AACzC,KAAC,YAAY;AACX,YAAM8B,MAAM,GAAG,MAAMlD,YAAY,EAAjC;;AACA,UAAI,CAACkD,MAAL,EAAa;AACXzE,QAAAA,YAAY,CAAC,EAAD,CAAZ;AACD,OAFD,MAEO;AACLA,QAAAA,YAAY,CAACyE,MAAM,CAACM,IAAR,CAAZ;AACD;AACF,KAPD;AAQD,GAVQ,EAUN,CAAClF,SAAD,CAVM,CAAT;AAYArB,EAAAA,SAAS,CAAC,MAAM;AACdgB,IAAAA,YAAY,CAAC;AACXT,MAAAA,KAAK,EAAEgC,UADI;AAEX/B,MAAAA,OAAO,EAAEgC,SAFE;AAGX/B,MAAAA,IAAI,EAAEiC,SAAS,CAACkC,GAAV,CAAc4B,GAAG,IAAIA,GAAG,CAACC,SAAzB;AAHK,KAAD,CAAZ;AAMA,QAAItE,MAAM,KAAK,QAAf,EAAyBrB,QAAQ,CAAC2B,QAAD,CAAR;AAC1B,GARQ,EAQN,EARM,CAAT,CAzLwB,CAmMxB;AACA;AACA;AACA;AACA;;AAEA,sBACE;AAAA,eACG0D,KADH,eAEE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,YAFF,EAGGpE,SAAS,iBACR,QAAC,OAAD;AAAS,MAAA,SAAS,EAAEA,SAApB;AAA+B,MAAA,YAAY,EAAEC;AAA7C;AAAA;AAAA;AAAA;AAAA,YAJJ,eAME;AAAK,MAAA,KAAK,EAAED,SAAS,GAAGD,WAAH,GAAiBF,SAAtC;AAAA,6BACE;AAAK,QAAA,KAAK,EAAE;AAAEC,UAAAA,OAAO,EAAE;AAAX,SAAZ;AAAA,gCACE,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AAAK,UAAA,KAAK,EAAE;AAAE6E,YAAAA,KAAK,EAAE;AAAT,WAAZ;AAAA,kCACE,QAAC,KAAD;AAAO,YAAA,KAAK,EAAE,OAAd;AAAuB,YAAA,YAAY,EAAE1E;AAArC;AAAA;AAAA;AAAA;AAAA,kBADF,eAGE;AAAK,YAAA,SAAS,EAAG,gBAAezC,MAAM,CAAC,aAAD,CAAgB,EAAtD;AAAA,mCACE;AAAK,cAAA,SAAS,EAAC,KAAf;AAAA,qCACE;AAAK,gBAAA,SAAS,EAAC,KAAf;AAAA,uCACE;AAAK,kBAAA,SAAS,EAAC,gCAAf;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAC,cAAf;AAAA,2CACE;AAAG,sBAAA,SAAS,EAAC,uBAAb;AAAA,8CACE,QAAC,IAAD;AACE,wBAAA,EAAE,EAAE,GADN;AAEE,wBAAA,KAAK,EAAE;AAAEoH,0BAAAA,cAAc,EAAE,MAAlB;AAA0BC,0BAAAA,KAAK,EAAE;AAAjC,yBAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BADF,eAOE,QAAC,IAAD;AACE,wBAAA,EAAE,EAAE,QADN;AAEE,wBAAA,KAAK,EAAE;AAAED,0BAAAA,cAAc,EAAE,MAAlB;AAA0BC,0BAAAA,KAAK,EAAE;AAAjC,yBAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAPF,eAaE,QAAC,IAAD;AACE,wBAAA,EAAE,EAAG,aADP;AAEE,wBAAA,KAAK,EAAE;AAAED,0BAAAA,cAAc,EAAE,MAAlB;AAA0BC,0BAAAA,KAAK,EAAE;AAAjC,yBAFT;AAAA,kCAIGzE,MAAM,KAAK,QAAX,GAAsB,MAAtB,GAA+B;AAJlC;AAAA;AAAA;AAAA;AAAA,8BAbF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BADF,eAuBE;AAAK,oBAAA,SAAS,EAAC,2BAAf;AAAA,2CACE,QAAC,MAAD;AACE,sBAAA,SAAS,EAAG,GAAE5C,MAAM,CAAC,WAAD,CAAc,cADpC;AAEE,sBAAA,OAAO,EAAE,MAAM2C,OAAO,CAAC2E,MAAR,CAAe,CAAC,CAAhB;AAFjB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BAvBF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,kBAHF,eAwCE;AACE,YAAA,SAAS,EAAG,GAAEtH,MAAM,CAAC,qBAAD,CAAwB,IAAGA,MAAM,CAAC,iBAAD,CAAoB,EAD3E;AAAA,mCAGE;AAAK,cAAA,SAAS,EAAC,WAAf;AAAA,qCACE;AAAK,gBAAA,SAAS,EAAC,KAAf;AAAA,uCACE;AAAK,kBAAA,SAAS,EAAC,wBAAf;AAAA,0CACE;AAAK,oBAAA,SAAS,EAAC,KAAf;AAAA,2CACE;AAAI,sBAAA,SAAS,EAAG,GAAEA,MAAM,CAAC,mBAAD,CAAsB,OAA9C;AAAA,gCACG4C,MAAM,KAAK,QAAX,GAAsB,MAAtB,GAA+B;AADlC;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,0BADF,eAME;AAAK,oBAAA,SAAS,EAAC,QAAf;AAAA,4CAEE,QAAC,cAAD;AACE,sBAAA,KAAK,EAAExB,KADT;AAEE,sBAAA,QAAQ,EAAEG,QAFZ;AAGE,sBAAA,UAAU,EAAEG,UAHd;AAIE,sBAAA,MAAM,EAAEkB;AAJV;AAAA;AAAA;AAAA;AAAA,4BAFF,eASE;AAAK,sBAAA,SAAS,EAAG,aAAY5C,MAAM,CAAC,iBAAD,CAAoB,EAAvD;AAAA,6CACE;AAAA,gDACE,QAAC,QAAD;AACE,0BAAA,SAAS,EAAEwB,SADb;AAEE,0BAAA,YAAY,EAAEC,YAFhB;AAGE,0BAAA,QAAQ,EAAEF,QAHZ;AAIE,0BAAA,SAAS,EAAEO,SAJb;AAKE,0BAAA,SAAS,EAAEE,SALb;AAME,0BAAA,YAAY,EAAED,YANhB;AAOE,0BAAA,SAAS,EAAEgB,SAPb;AAQE,0BAAA,UAAU,EAAErB,UARd;AASE,0BAAA,aAAa,EAAEC,aATjB;AAUE,0BAAA,KAAK,EAAEP,KAVT;AAWE,0BAAA,WAAW,EAAEQ;AAXf;AAAA;AAAA;AAAA;AAAA,gCADF,eAcE;AAAK,0BAAA,SAAS,EAAC,4BAAf;AAAA,kDACE;AACE,4BAAA,IAAI,EAAC,OADP;AAEE,4BAAA,SAAS,EAAG,GAAE5B,MAAM,CAAC,wBAAD,CAA2B,kCAFjD;AAGE,4BAAA,OAAO,EAAE,MAAM;AACbyB,8BAAAA,YAAY,CAACV,aAAD,CAAZ;AACA,kCAAI6B,MAAM,KAAK,QAAf,EAAyBrB,QAAQ,CAAC,EAAD,CAAR;AAC1B,6BANH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCADF,eAWE;AACE,4BAAA,SAAS,EAAG,GAAEvB,MAAM,CAAC,gBAAD,CAAmB,qBADzC;AAEE,4BAAA,OAAO,EAAE0E,CAAC,IAAI;AACZD,8BAAAA,iBAAiB,CAACC,CAAD,CAAjB;AACD,6BAJH;AAAA,sCAMG9B,MAAM,KAAK,QAAX,GAAsB,IAAtB,GAA6B;AANhC;AAAA;AAAA;AAAA;AAAA,kCAXF;AAAA;AAAA;AAAA;AAAA;AAAA,gCAdF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,4BATF;AAAA;AAAA;AAAA;AAAA;AAAA,0BANF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AAHF;AAAA;AAAA;AAAA;AAAA,kBAxCF,eAsGE,QAAC,MAAD;AAAA;AAAA;AAAA;AAAA,kBAtGF;AAAA;AAAA;AAAA;AAAA;AAAA,gBAFF,eA0GE,QAAC,UAAD;AAAY,UAAA,YAAY,EAAEH;AAA1B;AAAA;AAAA;AAAA;AAAA,gBA1GF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,YANF;AAAA,kBADF;AAuHD;;GAhUQpB,S;UAmBUX,W,EACDC,U;;;KApBTU,S;AAkUT,eAAeA,SAAf","sourcesContent":["import { Header, Title, AsideLeft, AsideRight, Footer } from '../layout/Layout';\r\nimport styles from './Share.module.scss';\r\nimport config from '../../Config';\r\nimport { getMemId } from '../../utils';\r\n\r\nimport { ReactComponent as Delete } from '../../imgs/delete-lg.svg';\r\nimport EditImgPreview from './components/EditImgPreview';\r\nimport EditForm from './components/EditForm';\r\nimport NavPage from '../layout/components/NavPage';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useLocation, useHistory, Link } from 'react-router-dom';\r\n\r\nimport { Button, Modal } from 'react-bootstrap';\r\n\r\nconst initFormState = {\r\n  title: '',\r\n  content: '',\r\n  tags: [],\r\n};\r\n\r\nconst initErrorState = {\r\n  title: '',\r\n  content: '',\r\n  files: '',\r\n};\r\n\r\nfunction ShareEdit(props) {\r\n  const [files, setFiles] = useState([]);\r\n  const [formState, setFormState] = useState(initFormState);\r\n  const [errorState, setErrorState] = useState(initErrorState);\r\n  const [formIsValid, setFormIsValid] = useState(true);\r\n  const [tagsInput, setTagsInput] = useState([]);\r\n  const [foundTags, setFoundTags] = useState([]);\r\n\r\n  // 取得用戶id\r\n  const mem_id = getMemId();\r\n\r\n  // 加入購物車光箱\r\n  const [show, setShow] = useState(false);\r\n\r\n  //加入NAVBar漢堡選單開關\r\n  const showBlock = { display: 'block' };\r\n  const hiddenBlock = { display: 'none' };\r\n  const { navIsOpen, setNavIsOpen } = props; // 解構NAVBAR\r\n\r\n  const location = useLocation(null);\r\n  const history = useHistory(null);\r\n  const {\r\n    action = 'ADD',\r\n    shareId = '',\r\n    orderId,\r\n    orderName = '',\r\n    shareTitle = '',\r\n    shareDesc = '',\r\n    itemImgs,\r\n    shareTags = [],\r\n    orderCate = '',\r\n  } = location.state || {};\r\n\r\n  const handleClose = () => setShow(false);\r\n  const handleShow = () => setShow(true);\r\n\r\n  const getFoundTags = async () => {\r\n    try {\r\n      const response = await fetch(config.GET_TAGS, {\r\n        method: 'POST',\r\n        headers: { 'content-type': 'application/json' },\r\n        body: JSON.stringify(tagsInput[0]),\r\n      });\r\n      if (!response.ok) throw new Error('No tags found!');\r\n      const itemsObj = await response.json();\r\n      return itemsObj;\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n  };\r\n\r\n  const checkFormValidity = e => {\r\n    e.preventDefault();\r\n\r\n    if (!formState.title || !formState.content || files.length === 0) {\r\n      setFormIsValid(false);\r\n      return;\r\n    }\r\n    if (action === 'UPDATE') {\r\n      submitUpdate();\r\n    }\r\n    if (action === 'ADD') {\r\n      submitUpload();\r\n    }\r\n  };\r\n\r\n  const submitUpload = async () => {\r\n    try {\r\n      if (!orderId) throw new Error('Unsuccessful upload !');\r\n\r\n      const submitForm = { ...formState };\r\n      const fd = new FormData();\r\n      const formArr = Object.entries(submitForm);\r\n      formArr.map(arr => {\r\n        return fd.append(arr[0], arr[1]);\r\n      });\r\n\r\n      // insert order id and images into formdata\r\n      fd.append('orderId', orderId);\r\n      files.map(file => fd.append('files', file));\r\n\r\n      const response = await fetch(config.UPLOAD_POST, {\r\n        method: 'POST',\r\n        'Content-Type': 'multipart/form-data',\r\n        body: fd,\r\n      });\r\n      if (!response.ok) throw new Error('Unsuccessful upload !');\r\n      handleShow();\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n  };\r\n\r\n  const submitUpdate = async () => {\r\n    try {\r\n      if (!orderId) throw new Error('Unsuccessful upload !');\r\n\r\n      let updateFiles = [...files];\r\n      updateFiles = updateFiles.map((file, i) => {\r\n        return { ...file, share_img_order: i + 1 };\r\n      });\r\n\r\n      const updateForm = {\r\n        ...formState,\r\n        images: updateFiles,\r\n        shareId,\r\n      };\r\n\r\n      const response = await fetch(config.UPDATE_POST, {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updateForm),\r\n      });\r\n      if (!response.ok) throw new Error('Unsuccessful update !');\r\n      handleShow();\r\n    } catch (err) {\r\n      console.error(err.message);\r\n    }\r\n  };\r\n\r\n  const creditAmountHandler = () => {\r\n    const cateCredits = [\r\n      { cate: 'cs', credit: 300 },\r\n      { cate: 'cm', credit: 500 },\r\n      { cate: 'set', credit: 800 },\r\n    ];\r\n\r\n    const amount = cateCredits.find(cateObj => cateObj.cate === orderCate);\r\n\r\n    return amount.credit;\r\n  };\r\n\r\n  const addCreditHandler = async () => {\r\n    const res = await fetch(\r\n      config.ADD_CREDIT + `${mem_id}/${creditAmountHandler()}`\r\n    );\r\n    const result = res.json();\r\n    if (result.success) {\r\n      // console.log('積分已加入資料庫');\r\n    }\r\n  };\r\n\r\n  const modal = (\r\n    <Modal show={show} onHide={handleClose}>\r\n      <Modal.Header closeButton>\r\n        <Modal.Title className=\"en-cont-30 m-3\">提醒</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body style={{ margin: '0 3%' }}>\r\n        <div className=\"en-cont-14 pb-2\">\r\n          {action === 'UPDATE'\r\n            ? '您的貼文已編輯成功!'\r\n            : `您的貼文上傳成功! 恭喜您獲得會員積分${creditAmountHandler()}點!`}\r\n        </div>\r\n      </Modal.Body>\r\n      <Modal.Footer>\r\n        <Button\r\n          variant=\"secondary\"\r\n          className=\"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\"\r\n          onClick={() => {\r\n            if (action === 'ADD') {\r\n              // console.log('新增積分300點');\r\n              addCreditHandler();\r\n            }\r\n            history.push('/share');\r\n          }}\r\n        >\r\n          Close\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n\r\n  // Finding tags when tag input changed\r\n  useEffect(() => {\r\n    if (Object.keys(tagsInput).length === 0) return;\r\n    (async () => {\r\n      const result = await getFoundTags();\r\n      if (!result) {\r\n        setFoundTags([]);\r\n      } else {\r\n        setFoundTags(result.data);\r\n      }\r\n    })();\r\n  }, [tagsInput]);\r\n\r\n  useEffect(() => {\r\n    setFormState({\r\n      title: shareTitle,\r\n      content: shareDesc,\r\n      tags: shareTags.map(tag => tag.item_hash),\r\n    });\r\n\r\n    if (action === 'UPDATE') setFiles(itemImgs);\r\n  }, []);\r\n\r\n  // const fileInputHandler = () => {\r\n  //   if (!fileInputRef.current) return '新增、拖曳照片';\r\n  //   let filesLength = fileInputRef.current.files.length;\r\n  //   if (filesLength !== 0) return `選擇${filesLength}個檔案`;\r\n  // };\r\n\r\n  return (\r\n    <>\r\n      {modal}\r\n      <Header />\r\n      {navIsOpen && (\r\n        <NavPage navIsOpen={navIsOpen} setNavIsOpen={setNavIsOpen} />\r\n      )}\r\n      <div style={navIsOpen ? hiddenBlock : showBlock}>\r\n        <div style={{ display: 'flex' }}>\r\n          <AsideLeft />\r\n          <div style={{ width: '100%' }}>\r\n            <Title title={'Share'} setNavIsOpen={setNavIsOpen} />\r\n\r\n            <div className={`mycontainer  ${styles['share-bread']}`}>\r\n              <div className=\"row\">\r\n                <div className=\"col\">\r\n                  <div className=\"d-flex justify-content-between\">\r\n                    <div className=\"pt-3 pt-md-0\">\r\n                      <p className=\"en-title-14-10 d-flex\">\r\n                        <Link\r\n                          to={'/'}\r\n                          style={{ textDecoration: 'none', color: '#575757' }}\r\n                        >\r\n                          HOME/&nbsp;\r\n                        </Link>\r\n                        <Link\r\n                          to={'/share'}\r\n                          style={{ textDecoration: 'none', color: '#575757' }}\r\n                        >\r\n                          SHARE/&nbsp;\r\n                        </Link>\r\n                        <Link\r\n                          to={`/share/edit`}\r\n                          style={{ textDecoration: 'none', color: '#b03342' }}\r\n                        >\r\n                          {action === 'UPDATE' ? 'EDIT' : 'UPLOAD'}\r\n                        </Link>\r\n                      </p>\r\n                    </div>\r\n                    <div className=\"d-flex align-items-center\">\r\n                      <Delete\r\n                        className={`${styles['large-del']} mx-md-4 p-2`}\r\n                        onClick={() => history.goBack(-1)}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className={`${styles['waterfall-container']} ${styles['edit-min-height']}`}\r\n            >\r\n              <div className=\"container\">\r\n                <div className=\"row\">\r\n                  <div className=\"col d-flex flex-column\">\r\n                    <div className=\"col\">\r\n                      <h2 className={`${styles['share-edit-header']} mb-5`}>\r\n                        {action === 'UPDATE' ? '編輯貼文' : '分享貼文'}\r\n                      </h2>\r\n                    </div>\r\n                    <div className=\"d-flex\">\r\n                      {/* Image preview area */}\r\n                      <EditImgPreview\r\n                        files={files}\r\n                        setFiles={setFiles}\r\n                        errorState={errorState}\r\n                        action={action}\r\n                      />\r\n                      {/* form area */}\r\n                      <div className={`col-md-12 ${styles['form-min-height']}`}>\r\n                        <form>\r\n                          <EditForm\r\n                            formState={formState}\r\n                            setFormState={setFormState}\r\n                            setFiles={setFiles}\r\n                            tagsInput={tagsInput}\r\n                            foundTags={foundTags}\r\n                            setTagsInput={setTagsInput}\r\n                            orderName={orderName}\r\n                            errorState={errorState}\r\n                            setErrorState={setErrorState}\r\n                            files={files}\r\n                            formIsValid={formIsValid}\r\n                          />\r\n                          <div className=\"d-flex justify-content-end\">\r\n                            <button\r\n                              type=\"reset\"\r\n                              className={`${styles['primeal-btn-outline-sm']} btn-sm btn-outline-primary mr-3`}\r\n                              onClick={() => {\r\n                                setFormState(initFormState);\r\n                                if (action !== 'UPDATE') setFiles([]);\r\n                              }}\r\n                            >\r\n                              清除\r\n                            </button>\r\n                            <button\r\n                              className={`${styles['primeal-btn-sm']} btn-sm btn-primary`}\r\n                              onClick={e => {\r\n                                checkFormValidity(e);\r\n                              }}\r\n                            >\r\n                              {action === 'UPDATE' ? '編輯' : '分享'}\r\n                            </button>\r\n                          </div>\r\n                        </form>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <Footer />\r\n          </div>\r\n          <AsideRight setNavIsOpen={setNavIsOpen} />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ShareEdit;\r\n"]},"metadata":{},"sourceType":"module"}