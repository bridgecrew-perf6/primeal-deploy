{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ryany\\\\OneDrive\\\\\\u684C\\u9762\\\\primeal\\\\src\\\\pages\\\\customize\\\\Customize.js\",\n    _s = $RefreshSig$();\n\nimport { Title } from './../layout/Layout';\nimport './customize.scss';\nimport MtlLeft from './components/MtlLeft';\nimport MtlMid from './components/MtlMid';\nimport MtlRight from './components/MtlRight';\nimport { useEffect, useState, useRef } from 'react'; // import { mtlData } from './sushiMtlTest';\n\nimport { useHistory } from 'react-router-dom';\nimport { Button, Modal } from 'react-bootstrap';\nimport config from '../../Config';\nimport NavPage from '../layout/components/NavPage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction Customize(props) {\n  _s();\n\n  // 購物車數字變化\n  const [cart_count, setCart_count] = useState(0);\n  useEffect(() => {\n    setCart_count(localStorage.getItem('cart_count'));\n  }, [props.changeCartCount]); // 判斷登入\n\n  const isLogin = localStorage.getItem('loginStatus');\n  const loginMemid = localStorage.getItem('mem_id');\n  const mem_photo = localStorage.getItem('mem_photo');\n  const history = useHistory(); // nav\n\n  const {\n    navIsOpen,\n    setNavIsOpen\n  } = props;\n  const showBlock = {\n    display: 'block'\n  };\n  const hiddenBlock = {\n    display: 'none'\n  }; // 材料Data\n\n  const [mtlDataSQL, setMtlDataSQL] = useState({});\n  const [addMtlData, setAddMtlData] = useState([]); // 3D\n\n  const canvasRef = useRef(null);\n  const [altTotal, setAltTotal] = useState(1);\n  const [indexTotal, setIndexTotal] = useState(0);\n  const [sushiGroup, setSushiGroup] = useState([{\n    map: `${config.HOST}/img/mtl/three/rice.jpg`,\n    normalMap: `${config.HOST}/img/mtl/three/rice-normal3.png`,\n    height: 0.5,\n    alt: -0.05,\n    // 預設增加高度\n    fixIndex: 0\n  }]);\n  let goDetail = useHistory(); // 換頁用\n  // 左右選單\n\n  const [openLArea, setOpenLArea] = useState(false);\n  const [openRArea, setOpenRArea] = useState(false); // 接SQL資料\n\n  useEffect(() => {\n    const catchData = async () => {\n      const mtlRes = await fetch(config.GET_MTLS);\n      const mtlObj = await mtlRes.json();\n      const mtlDatas = mtlObj.rows;\n      setMtlDataSQL(mtlDatas);\n    };\n\n    catchData();\n    setAddMtlData([{\n      mtlId: 1,\n      mtlPct: 1\n    }]);\n  }, []); // 轉換blob格式\n\n  function dataURLtoBlob(dataurl) {\n    var arr = dataurl.split(','),\n        mime = arr[0].match(/:(.*?);/)[1],\n        bstr = atob(arr[1]),\n        n = bstr.length,\n        u8arr = new Uint8Array(n);\n\n    while (n--) {\n      u8arr[n] = bstr.charCodeAt(n);\n    }\n\n    return new Blob([u8arr], {\n      type: mime\n    });\n  } // 傳送資料至後端\n\n\n  const postCusData = async () => {\n    const dataUrl = canvasRef.current.toDataURL('image/jpeg', 0.5);\n    const blobImg = dataURLtoBlob(dataUrl);\n    const fd = new FormData(); // insert order id and images into formdata\n\n    fd.append('canvasImage', blobImg, 'sushi.jpg');\n    fd.append('cm_prod', JSON.stringify(addMtlData));\n    fd.append('memid', localStorage.getItem('mem_id'));\n    const res = await fetch(config.POST_CUS_DATA, {\n      method: 'POST',\n      'Content-Type': 'multipart/form-data',\n      body: fd\n    });\n    const resJson = await res.json();\n  }; // 儲存提示光箱\n\n\n  const [saveShow, setSaveShow] = useState(false);\n\n  const handleSaveClose = () => setSaveShow(false);\n\n  const handleSaveShow = () => setSaveShow(true);\n\n  const saveModel = /*#__PURE__*/_jsxDEV(Modal, {\n    show: saveShow,\n    onHide: handleSaveClose,\n    children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n      closeButton: true,\n      children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n        className: \"en-cont-30 m-3\",\n        children: \"\\u63D0\\u9192\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n      style: {\n        margin: '0 3%'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"en-cont-14 pb-2\",\n        children: \"\\u5DF2\\u70BA\\u60A8\\u5132\\u5B58\\u7576\\u524D\\u8CC7\\u6599\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"secondary\",\n        className: \"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\",\n        onClick: handleSaveClose,\n        children: \"Close\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 106,\n    columnNumber: 5\n  }, this); // 換頁提示光箱\n\n\n  const [nextShow, setNextShow] = useState(false);\n\n  const handleNextClose = () => setNextShow(false);\n\n  const handleNextShow = () => setNextShow(true);\n\n  const nextModel = /*#__PURE__*/_jsxDEV(Modal, {\n    show: nextShow,\n    onHide: handleNextClose,\n    children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n      closeButton: true,\n      children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n        className: \"en-cont-30 m-3\",\n        children: \"\\u63D0\\u9192\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n      style: {\n        margin: '0 3%'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"en-cont-14 pb-2\",\n        children: \"\\u5373\\u5C07\\u96E2\\u958B\\u88FD\\u4F5C\\u9801\\u9762\\uFF0C\\u8ACB\\u554F\\u662F\\u5426\\u8981\\u524D\\u5F80\\u53D6\\u540D\\u9801\\u9762\\uFF1F\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        variant: \"secondary\",\n        className: \"btn btn-sm btn-primary primeal-btn-sm mx-md-4 mx-2\",\n        onClick: handleNextClose,\n        children: \"\\u53D6\\u6D88\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \" btn btn-sm btn-primary primeal-btn-sm mx-md-4 mx-2 m-3\",\n        className: \"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\",\n        onClick: () => {\n          postCusData();\n          handleNextClose();\n          goDetail.push('./cusmidetail');\n        },\n        children: \"\\u78BA\\u8A8D\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this);\n\n  if (!isLogin) {\n    history.push('/member/login');\n    return /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false);\n  } else {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [navIsOpen && /*#__PURE__*/_jsxDEV(NavPage, {\n        navIsOpen: navIsOpen,\n        setNavIsOpen: setNavIsOpen\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: navIsOpen ? hiddenBlock : showBlock,\n        children: [saveModel, nextModel, /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mtlHeader\",\n          children: /*#__PURE__*/_jsxDEV(Title, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container-fluid customize\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"row mtlView\",\n            children: [/*#__PURE__*/_jsxDEV(MtlLeft, {\n              altTotal: altTotal,\n              setAltTotal: setAltTotal,\n              indexTotal: indexTotal,\n              setIndexTotal: setIndexTotal,\n              sushiGroup: sushiGroup,\n              setSushiGroup: setSushiGroup,\n              mtlData: mtlDataSQL,\n              addMtlData: addMtlData,\n              setAddMtlData: setAddMtlData,\n              openLArea: openLArea,\n              setOpenLArea: setOpenLArea\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MtlMid, {\n              mtlData: mtlDataSQL,\n              addMtlData: addMtlData,\n              sushiGroup: sushiGroup,\n              setSushiGroup: setSushiGroup,\n              ref: canvasRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MtlRight, {\n              mtlData: mtlDataSQL,\n              addMtlData: addMtlData,\n              setAddMtlData: setAddMtlData,\n              altTotal: altTotal,\n              setAltTotal: setAltTotal,\n              indexTotal: indexTotal,\n              setIndexTotal: setIndexTotal,\n              sushiGroup: sushiGroup,\n              setSushiGroup: setSushiGroup,\n              handleSaveShow: () => setSaveShow(true),\n              handleNextShow: () => setNextShow(true),\n              postCusData: postCusData,\n              navIsOpen: navIsOpen,\n              setNavIsOpen: setNavIsOpen,\n              cart_count: cart_count,\n              setCart_count: setCart_count,\n              loginMemid: loginMemid,\n              mem_photo: mem_photo,\n              openRArea: openRArea,\n              setOpenRArea: setOpenRArea\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n}\n\n_s(Customize, \"AKP7lhEFBplhzaNFgbzNe1W3K4A=\", false, function () {\n  return [useHistory, useHistory];\n});\n\n_c = Customize;\nexport default Customize;\n\nvar _c;\n\n$RefreshReg$(_c, \"Customize\");","map":{"version":3,"sources":["C:/Users/ryany/OneDrive/桌面/primeal/src/pages/customize/Customize.js"],"names":["Title","MtlLeft","MtlMid","MtlRight","useEffect","useState","useRef","useHistory","Button","Modal","config","NavPage","Customize","props","cart_count","setCart_count","localStorage","getItem","changeCartCount","isLogin","loginMemid","mem_photo","history","navIsOpen","setNavIsOpen","showBlock","display","hiddenBlock","mtlDataSQL","setMtlDataSQL","addMtlData","setAddMtlData","canvasRef","altTotal","setAltTotal","indexTotal","setIndexTotal","sushiGroup","setSushiGroup","map","HOST","normalMap","height","alt","fixIndex","goDetail","openLArea","setOpenLArea","openRArea","setOpenRArea","catchData","mtlRes","fetch","GET_MTLS","mtlObj","json","mtlDatas","rows","mtlId","mtlPct","dataURLtoBlob","dataurl","arr","split","mime","match","bstr","atob","n","length","u8arr","Uint8Array","charCodeAt","Blob","type","postCusData","dataUrl","current","toDataURL","blobImg","fd","FormData","append","JSON","stringify","res","POST_CUS_DATA","method","body","resJson","saveShow","setSaveShow","handleSaveClose","handleSaveShow","saveModel","margin","nextShow","setNextShow","handleNextClose","handleNextShow","nextModel","push"],"mappings":"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","sourcesContent":["import { Title } from './../layout/Layout';\r\nimport './customize.scss';\r\nimport MtlLeft from './components/MtlLeft';\r\nimport MtlMid from './components/MtlMid';\r\nimport MtlRight from './components/MtlRight';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\n// import { mtlData } from './sushiMtlTest';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { Button, Modal } from 'react-bootstrap';\r\nimport config from '../../Config';\r\nimport NavPage from '../layout/components/NavPage';\r\n\r\nfunction Customize(props) {\r\n  // 購物車數字變化\r\n  const [cart_count, setCart_count] = useState(0);\r\n  useEffect(() => {\r\n    setCart_count(localStorage.getItem('cart_count'));\r\n  }, [props.changeCartCount]);\r\n\r\n  // 判斷登入\r\n  const isLogin = localStorage.getItem('loginStatus');\r\n  const loginMemid = localStorage.getItem('mem_id');\r\n  const mem_photo = localStorage.getItem('mem_photo');\r\n  const history = useHistory();\r\n\r\n  // nav\r\n  const { navIsOpen, setNavIsOpen } = props;\r\n  const showBlock = { display: 'block' };\r\n  const hiddenBlock = { display: 'none' };\r\n\r\n  // 材料Data\r\n  const [mtlDataSQL, setMtlDataSQL] = useState({});\r\n  const [addMtlData, setAddMtlData] = useState([]);\r\n\r\n  // 3D\r\n  const canvasRef = useRef(null);\r\n  const [altTotal, setAltTotal] = useState(1);\r\n  const [indexTotal, setIndexTotal] = useState(0);\r\n  const [sushiGroup, setSushiGroup] = useState([\r\n    {\r\n      map: `${config.HOST}/img/mtl/three/rice.jpg`,\r\n      normalMap: `${config.HOST}/img/mtl/three/rice-normal3.png`,\r\n      height: 0.5,\r\n      alt: -0.05, // 預設增加高度\r\n      fixIndex: 0,\r\n    },\r\n  ]);\r\n\r\n  let goDetail = useHistory(); // 換頁用\r\n\r\n  // 左右選單\r\n  const [openLArea, setOpenLArea] = useState(false);\r\n  const [openRArea, setOpenRArea] = useState(false);\r\n\r\n  // 接SQL資料\r\n  useEffect(() => {\r\n    const catchData = async () => {\r\n      const mtlRes = await fetch(config.GET_MTLS);\r\n      const mtlObj = await mtlRes.json();\r\n      const mtlDatas = mtlObj.rows;\r\n\r\n      setMtlDataSQL(mtlDatas);\r\n    };\r\n    catchData();\r\n    setAddMtlData([{ mtlId: 1, mtlPct: 1 }]);\r\n  }, []);\r\n\r\n  // 轉換blob格式\r\n  function dataURLtoBlob(dataurl) {\r\n    var arr = dataurl.split(','),\r\n      mime = arr[0].match(/:(.*?);/)[1],\r\n      bstr = atob(arr[1]),\r\n      n = bstr.length,\r\n      u8arr = new Uint8Array(n);\r\n    while (n--) {\r\n      u8arr[n] = bstr.charCodeAt(n);\r\n    }\r\n    return new Blob([u8arr], { type: mime });\r\n  }\r\n\r\n  // 傳送資料至後端\r\n  const postCusData = async () => {\r\n    const dataUrl = canvasRef.current.toDataURL('image/jpeg', 0.5);\r\n    const blobImg = dataURLtoBlob(dataUrl);\r\n    const fd = new FormData();\r\n\r\n    // insert order id and images into formdata\r\n    fd.append('canvasImage', blobImg, 'sushi.jpg');\r\n    fd.append('cm_prod', JSON.stringify(addMtlData));\r\n    fd.append('memid', localStorage.getItem('mem_id'));\r\n\r\n    const res = await fetch(config.POST_CUS_DATA, {\r\n      method: 'POST',\r\n      'Content-Type': 'multipart/form-data',\r\n      body: fd,\r\n    });\r\n    const resJson = await res.json();\r\n  };\r\n\r\n  // 儲存提示光箱\r\n  const [saveShow, setSaveShow] = useState(false);\r\n  const handleSaveClose = () => setSaveShow(false);\r\n  const handleSaveShow = () => setSaveShow(true);\r\n  const saveModel = (\r\n    <Modal show={saveShow} onHide={handleSaveClose}>\r\n      <Modal.Header closeButton>\r\n        <Modal.Title className=\"en-cont-30 m-3\">提醒</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body style={{ margin: '0 3%' }}>\r\n        <div className=\"en-cont-14 pb-2\">已為您儲存當前資料</div>\r\n      </Modal.Body>\r\n      <Modal.Footer>\r\n        <Button\r\n          variant=\"secondary\"\r\n          className=\"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\"\r\n          onClick={handleSaveClose}\r\n        >\r\n          Close\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n\r\n  // 換頁提示光箱\r\n  const [nextShow, setNextShow] = useState(false);\r\n  const handleNextClose = () => setNextShow(false);\r\n  const handleNextShow = () => setNextShow(true);\r\n  const nextModel = (\r\n    <Modal show={nextShow} onHide={handleNextClose}>\r\n      <Modal.Header closeButton>\r\n        <Modal.Title className=\"en-cont-30 m-3\">提醒</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body style={{ margin: '0 3%' }}>\r\n        <div className=\"en-cont-14 pb-2\">\r\n          即將離開製作頁面，請問是否要前往取名頁面？\r\n        </div>\r\n      </Modal.Body>\r\n      <Modal.Footer>\r\n        <Button\r\n          variant=\"secondary\"\r\n          className=\"btn btn-sm btn-primary primeal-btn-sm mx-md-4 mx-2\"\r\n          onClick={handleNextClose}\r\n        >\r\n          取消\r\n        </Button>\r\n        <Button\r\n          variant=\" btn btn-sm btn-primary primeal-btn-sm mx-md-4 mx-2 m-3\"\r\n          className=\"btn btn-sm btn-primary primeal-btn-sm mx-5 m-3\"\r\n          onClick={() => {\r\n            postCusData();\r\n            handleNextClose();\r\n            goDetail.push('./cusmidetail');\r\n          }}\r\n        >\r\n          確認\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n\r\n  if (!isLogin) {\r\n    history.push('/member/login');\r\n    return <></>;\r\n  } else {\r\n    return (\r\n      <>\r\n        {navIsOpen && (\r\n          <NavPage navIsOpen={navIsOpen} setNavIsOpen={setNavIsOpen} />\r\n        )}\r\n        <div style={navIsOpen ? hiddenBlock : showBlock}>\r\n          {saveModel}\r\n          {nextModel}\r\n          <div className=\"mtlHeader\">\r\n            <Title />\r\n          </div>\r\n          <div className=\"container-fluid customize\">\r\n            <div className=\"row mtlView\">\r\n              <MtlLeft\r\n                altTotal={altTotal}\r\n                setAltTotal={setAltTotal}\r\n                indexTotal={indexTotal}\r\n                setIndexTotal={setIndexTotal}\r\n                sushiGroup={sushiGroup}\r\n                setSushiGroup={setSushiGroup}\r\n                mtlData={mtlDataSQL}\r\n                addMtlData={addMtlData}\r\n                setAddMtlData={setAddMtlData}\r\n                openLArea={openLArea}\r\n                setOpenLArea={setOpenLArea}\r\n              />\r\n\r\n              <MtlMid\r\n                mtlData={mtlDataSQL}\r\n                addMtlData={addMtlData}\r\n                sushiGroup={sushiGroup}\r\n                setSushiGroup={setSushiGroup}\r\n                ref={canvasRef}\r\n              />\r\n              <MtlRight\r\n                mtlData={mtlDataSQL}\r\n                addMtlData={addMtlData}\r\n                setAddMtlData={setAddMtlData}\r\n                altTotal={altTotal}\r\n                setAltTotal={setAltTotal}\r\n                indexTotal={indexTotal}\r\n                setIndexTotal={setIndexTotal}\r\n                sushiGroup={sushiGroup}\r\n                setSushiGroup={setSushiGroup}\r\n                handleSaveShow={() => setSaveShow(true)}\r\n                handleNextShow={() => setNextShow(true)}\r\n                postCusData={postCusData}\r\n                navIsOpen={navIsOpen}\r\n                setNavIsOpen={setNavIsOpen}\r\n                cart_count={cart_count}\r\n                setCart_count={setCart_count}\r\n                loginMemid={loginMemid}\r\n                mem_photo={mem_photo}\r\n                openRArea={openRArea}\r\n                setOpenRArea={setOpenRArea}\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Customize;\r\n"]},"metadata":{},"sourceType":"module"}